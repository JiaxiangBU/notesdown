---
title: "R 语言学习笔记"
author: "黄湘云"
date: "`r format(Sys.time(), tz = 'Asia/Taipei', usetz = TRUE)`"
site: bookdown::bookdown_site
geometry: margin=1.18in
documentclass: ctexbook
bibliography: [book.bib, packages.bib]
biblio-style: apalike
lof: yes
lot: yes
graphics: yes
tables: yes
link-citations: yes
links-as-notes: no
colorlinks: yes
classoption: "hyperref, a4paper, UTF8, zihao = -4, linespread = 1.3"
description: "这是一个R语言学习笔记"
url: 'https\://bookdown-chinese.netlify.com/'
github-repo: "xiangyunhuang/notesdown"
cover-image: "images/dragon.svg"
apple-touch-icon: "images/dragon.svg"
apple-touch-icon-size: 120
favicon: "favicon.ico"
---

\mainmatter

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  echo = TRUE,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  cache = FALSE,
  # fig.showtext = TRUE,
  fig.asp = 0.618, # 1 / phi
  fig.show = "hold"
)
is_on_travis = identical(Sys.getenv("TRAVIS"), "true")
is_online = curl::has_internet()
```

# 前言

> 荃者所以在鱼，得鱼而忘荃；蹄者所以在兔；得兔而忘蹄；言者所以在意，得意而忘言。吾安得夫忘言之人而与之言哉！

```{block2, type = 'flushright', html.tag = 'p'}
--- 摘自 《庄子·杂篇·物》
```

> The fish trap exists because of the fish; once you've gotten the fish, you can forget the trap. The rabbit snare exists because of the rabbit; once you've gotten the rabbit, you can forget the snare. Words exist because of meaning; once you've gotten the meaning, you can forget the words. Where can I find a man who has forgotten words so I can have a word with him ? ^[Translated by [Eric D. Kolaczyk](http://math.bu.edu/people/kolaczyk/teach.html)]

```{block2, type = 'flushright', html.tag = 'p'}
--- Chuang Tzu
```

```{block2, type = 'rmdnote'}
这是一本面向小众群体的笔记，没有太多的基础语法介绍，假设你已经达到入门级别了，也学过线性代数和数理统计，这本笔记还处在很早期的阶段。
```

1. 把平时遇到的问题分类汇总形成一本笔记，用以时常查看和更新。
2. 网罗精美的案例，学习之，应用之
3. 挑选感兴趣的新技能，钻研之
4. 学习心得和体会，尤其是那些年的淌坑经历
5. 从使用者到开发者蜕变，先啃一下 Hadley Wickham 的几本书：
    + The tidyverse style guide/A style guide for the R language <http://style.tidyverse.org/>
    + Advanced R <https://adv-r.hadley.nz/>
    + R packages <http://r-pkgs.had.co.nz/>
    + R for Data Science <http://r4ds.had.co.nz/>
6. 要写书搭网站，先看一下 Yihui Xie 的书
    + bookdown: Authoring Books and Technical Documents with R Markdown <https://bookdown.org/yihui/bookdown/>
    + blogdown: Creating Websites with R Markdown <https://bookdown.org/yihui/blogdown/>
    + R Markdown: The Definitive Guide <https://bookdown.org/yihui/rmarkdown/>


## 作者

我是黄湘云，即将毕业的硕士研究生，跟随导师学习数理统计，主修 R 语言，顺便学了点统计，南方人， 2017年6月开始混迹于 Github ， 虽然2015年就注册了， 但是一直没有用起来， 后来有了直接的刚需（因为工作需要嘛），全是自学和靠大牛指点，偶尔参加一些技术大会和沙龙， 周边学校也去听讲座， 对学术大牛心里充满无限敬仰， 多亏 [qiaozhang1993](https://github.com/qiaozhang1993) 搜集各大高校的讲座信息并时常分享于我。

本科学过 Photoshop 接触过 AI 和 AE，后来学了 R 这些就淡忘了，但是图层这个概念却一直记忆犹新，因为图层在 ggplot2 中是一个很关键的概念。

Python 喊着要学，已经叫唤两年了，今年打算学个入门。
Mxnet、Xgboost 和 Stan 也是要学的，下半年正式入职京东了，另外一个可能要学的是 [INLA](http://www.r-inla.org) 专用于处理空间广义线性混合效应模型，这个会在混合效应模型的相关章节予以介绍。

## 致谢

虚位以待壮士

```{r contribs, results = "asis", echo = FALSE}
# copy from https://github.com/hadley/adv-r/edit/master/Introduction.Rmd
# contribs <- system("git --no-pager shortlog -ns > contribs.txt", intern = T)
contribs <- read.delim("contribs.txt", header = FALSE,
  stringsAsFactors = FALSE)[-1, ]
names(contribs) <- c("n", "name")

contribs <- contribs[order(contribs$name), ]
contribs$uname <- ifelse(!grepl(" ", contribs$name),
  paste0("\\@", contribs$name), contribs$name)

cat("Thanks go to all contributers in alphabetical order: ")
cat(paste0(contribs$uname, collapse = ", "))
cat(".\n")
```

非常感谢谁谁以及谁谁对我的帮助。

```{block2, type = 'flushright', html.tag = 'p'}
黄湘云  
于矿大宝源公寓
```

## 结构

第一章：数学符号说明
第二章：基础知识

- R语言基础、高级技巧

你好，世界。我写了一本书。这本书是这样的，第 \@ref(color) 章介绍了啥啥，第 \@ref(graphics) 章说了啥啥，然后是啥啥……

- 第 \@ref(animotion) 章介绍 animation、mapmate、rgl
- 第 \@ref(mcmc) 章介绍 rstan
- 第 \@ref(spatial) 章介绍 sf
- 第 \@ref(network) 章介绍 igraph

## 记号

- $S \neq \varnothing$
- 
- $\mathbf{A,B,C},\mathsf{A,B,C},\mathit{A,B,C}$
- $\mathrm{A,B,C}$
- $\mathfrak{A,B,C}$
- $$X,Y,D, \mathbf{X,Y,D},\mathsf{X,Y,D},\mathit{X,Y,D},\mathrm{X,Y,D}$$

$A,B,C,D$ 斜体表示普通的集合，$X,Y,Z$ 表示矩阵，$a,b,c,d$ 表示常数，$\alpha,\beta,\theta,\phi,\kappa$ 表示模型或者分布函数的参数，$\Theta$ 表示参数空间，$\mathbb{R}^{n},\mathbb{C}^{n}$ 表示特殊的 $n$ 维实（复）数域，$\mathscr{A,B,C,D}$ 表示一般的数域，$\mathcal{S,P,G}$ 分别表示随机过程、概率空间和图

符号   | 含义             | 符号  | 含义
 :---: |   :----------:   | :---: |  :----------: 
$\mathbf{A}$               | 粗体            | $\Omega$                   | 全集
$\mathit{A}$               | 集合            | $\mathbb{R,C}$             | 实（复）数集
$\mathcal{A}$              | 集族            | $\varnothing$               | 空集
$\mathsf{A}$               | 矩阵            | $\mathsf{A}^{-}$            | 矩阵的广义逆
$\mathsf{A}^\top$          | 矩阵转置        | $\bar{x}$                   | 平均值
$\mathsf{A}^\mathrm{-1}$   | 矩阵的逆        | $\vert a \vert$             | 标量绝对值
$\mathsf{A}^{\star}$       | 伴随矩阵        | $\mathop{\mathrm{diag}}(\mathsf{A})$ | 矩阵的对角
$\lVert \mathsf{A} \rVert_{1}$       | 矩阵的1范数     | $\mathsf{I}$                | 单位矩阵
$\lVert \mathsf{A} \rVert_{2}$       | 矩阵的2范数     | $\mathsf{I}_{n}$            | $n$ 阶单位矩阵
$\lVert \mathsf{A} \rVert_{\infty}$  | 矩阵的无穷范数  | $\mathsf{1}$                | 全1矩阵
$\lVert \mathsf{X} \rVert_{1}$       | 向量的1范数     | $\mathsf{1}_{n}$            | $n$ 阶全1矩阵
$\lVert \mathsf{X} \rVert_{2}$       | 向量的2范数     | $\lVert \mathsf{X} \rVert_{\infty}$  | 向量的无穷范数
$\langle\mathsf{X},\mathsf{Y}\rangle$ | 向量的内积    | $f(\mathsf{X})$        | 随机变量的函数
$\mathsf{X} \wedge \mathsf{Y}$       | 向量的外积     | $\nabla{\mathsf{X}}$   | 向量微分或梯度
$\beta$                              | 模型系数             | $\theta$               | 模型或分布参数
$\alpha$                             | 模型截距             | $\Theta$               | 参数空间
$\hat{\beta}_{ls}$                   | 模型系数的LS估计     | $f(x)$                 | 标量值函数
$\hat{\beta}_{mle}$                  | 模型系数的MLE估计    | $f(\mathsf{X})$        | 向量的函数
$\hat{\beta}_{bayes}$                | 模型系数的Bayes估计  | $\mathcal{X}$          | 概率空间
$\rho$                              | 相关系数            | $\kappa$      | 贝塞尔函数的阶
$\phi$                              | 尺度参数            | $u$           | 距离 $\lVert \mathsf{x}_1 -\mathsf{x}_2 \rVert$
$\mathbb{R}^2$                      | 二维实数域        | $S(x)$        | 空间过程
$\mathcal{S}$      | $\mathcal{S} = \{S(x):x \in \mathbb{R}^2\}$ | $\mathcal{S}^{\star}$  | 随机过程 $\mathcal{S}$ 的近似

- 多元统计分析 高惠璇 矩阵符号表示
- 深度学习符号表示 <https://github.com/XiangyunHuang/dlbook>

举例，线性模型的表示，此处 $Y$ 为 $n\times 1$列向量，$X$ 为$p\times n$的矩阵，$\beta$ 为 $p\times 1$的列向量 ，$\epsilon$ 为$n\times1$列向量
$$Y = X'\beta + \epsilon$$
$$\mathsf{A} = \varGamma^\top\Lambda\varGamma$$
$$\mathsf{u} = (u_1,u_2,\cdots,u_n)$$
$$\mathsf{x} = (x_1,x_2,\cdots,x_n)$$
期望 $\mathsf{E}$ 正态分布 $\mathcal{N}(\mathsf{x};\mathsf{\mu},\mathsf{\Sigma})$
对数 $\mathsf{\log}$ 协方差 $\mathsf{Cov},\mathsf{Var}$ 

矩阵 $$\mathsf{Y} = (\mathsf{y}^{(1)},\mathsf{y}^{(n)},\cdots,\mathsf{y}^{(n)})$$
其中 $\mathsf{y}^{(i)} = (y_{1i},y_{2i},\cdots,y_{ni})$ 表示第 $i$ 列

梅隆函数(Matern function)是描述空间相关性的常用函数，它带有两参数$\kappa$ 和 $\phi$，具体形式如下：
$$\rho(u) = \big\{2^{\kappa-1}\Gamma(\kappa)\big\}^{-1}(u/\phi)^{\kappa}K_{\kappa}(u/\phi)$$
其中，$K_{\kappa}(\cdot)$ 表示 $\kappa$ 阶修正的贝塞尔函数



## 后记

这本书是在 [RStudio](https://www.rstudio.com/products/rstudio/download/) 内用 [R Markdown](https://rmarkdown.rstudio.com/) 写的， [Git](https://git-scm.com/) 控制版本， [bookdown](https://bookdown.org/yihui/bookdown/) 组织章节， [knitr](https://yihui.name/knitr/) 将 R Markdown 源文件转化为 Markdown 文件， [Pandoc](http://pandoc.org) \index{Pandoc} 再将 Markdown 文件转化为 HTML 文档，而要转化为 PDF 文档则另外需要 TinyTeX\index{TinyTeX} 发行版^[<https://yihui.name/tinytex/>] 和来自 **rticles** [@R-rticles] 包的模板（一个基于 Pandoc 的 LaTeX 模板，两个美元符号包含的就是变量，变量基本上是 LaTeX 包的设置选项）。这个网站是通过 [Travis-CI](https://travis-ci.org/) 把编译结果（即 `_book` 目录）推送到 [Netlify](https://www.netlify.com/)，实现部署。在 Travis-CI 和 Netlify 都与 Github 绑定的情况下，源代码一发生改变就会触发编译和部署，即持续集成和连续部署，本书尝试采用两种编译方式，如图\@ref(fig:00-workflow)。

 `r if(knitr::is_html_output()) "Travis-CI 还提供一个指示器报告编译的状态：[![Build Status](https://travis-ci.org/XiangyunHuang/notesdown.svg?branch=master)](https://travis-ci.org/XiangyunHuang/notesdown)"`

```{r 00-workflow, echo = FALSE, fig.cap="书籍写作流程"}
ext <- if (knitr::is_html_output()) ".svg" else if (knitr::is_latex_output()) ".pdf" else ".png"
knitr::include_graphics(path = paste0("diagrams/00-workflow", ext))
```

[sourceserifpro](https://ctan.org/pkg/sourceserifpro) 设为默认英文字体，[inconsolata](http://levien.com/type/myfonts/inconsolata.html) 用于代码显示，R 包名称在文中以粗体显示，代码块输出用 `#>` 表示，以区分普通的代码注释 `#`

我用了两个 R 包编译这本书，分别是 **knitr**\index{knitr} [@Dynamic2015CRC] 和 **bookdown**\index{bookdown} [@bookdown2016CRC]。绘图使用的中文字体是思源宋体和思源黑体， **showtext**\index{showtext} 包安装和调用，**tikzDevice**\index{tikzDevice} 和 **fontcm**\index{fontcm} 处理其中的数学公式，**xkcd**\index{xkcd} 设置漫画手写体风格，以下是我的 R 进程信息：

```{r}
sessionInfo()
```

## 许可

本书采用 [知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议](https://creativecommons.org/licenses/by-nc-nd/4.0/) 许可，请君自重，别没事儿拿去传个什么新浪爱问、百度文库以及 XX 经济论坛，项目中代码使用 [MIT 协议](https://github.com/XiangyunHuang/bookdown-chinese/blob/master/LICENSE) 开源，你正在阅读的是 `r Sys.Date()` 在 `r if(is_on_travis) "[Travis](https://travis-ci.org/XiangyunHuang/bookdown-chinese)" else "本地"` 构建的。

```{r, include = FALSE, cache = FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(TRUE)
), "packages.bib")
```
