# (PART) 基础篇 {-}

# 安装和配置 {#install}

```{r setup, include = FALSE}
Pkgs <- c(
  "RDieHarder", "magrittr"
)
if (length(setdiff(Pkgs, .packages(TRUE))) > 0) 
  install.packages(setdiff(Pkgs, .packages(TRUE)))
```

## 编译 R

从源码编译 R 的需求在哪呢？

1. 爱折腾的极客：玩配置
2. 追求性能：如 LFS 支持和 Intel MKL 加速
3. 环境限制：CentOS 6/7 或者红帽系统，自带的R版本比较落后
4. 微软提供的一套 MSR （这里不需要编译）

## 安装 RStudio

下载 <https://www.rstudio.com/products/rstudio/download/>

- 桌面版

1. window
2. linux

- 服务器版

1. 以 centos 为例
2. 以 rocker 为例

## 安装 R 包

- 从指定的镜像站点安装（源头）

```{r,eval=FALSE}
install.packages("rbokeh", repos = "https://mirrors.tuna.tsinghua.edu.cn/CRAN/")
```

- 再指定安装的位置（本地）

```{r,eval=FALSE}
install.packages("rbokeh",
  repos = c(
    deltarho = "http://packages.deltarho.org",
    getOption("repos")
  ),
  lib = R.home("site-library")
)
```

- 安装 Bioconductor 上的 R 包

```{r,eval=FALSE}
source("https://bioconductor.org/biocLite.R")
BiocInstaller::biocLite("rbokeh")
```

- 安装Github上的R包

```{r,eval=FALSE}
devtools::install_github("bokeh/rbokeh")
```

- 依赖问题：主要针对离线安装和源码编译安装
- 平台问题：有些 R 包只能装在 Linux 操作系统上
- 软件问题：有些 R 包要求相应 R 软件版本
- 特定库依赖：如 **RDieHarder** \index{RDieHarder} 包就依赖 `libgsl-dev` 和 `libdieharder-dev` 库

所以我们需要查看以下信息

```{r}
sessionInfo()
```

有时候甚至是

```{r}
devtools::session_info("showtext")
```

```{block2, type='rmdnote'}
推荐 `devtools::session_info("package")` 而不是 `sessionInfo()`，尤其在遇到因为版本不对而带来错误的时候，如 <https://d.cosx.org/d/419765-showtext>
```

### RDieHarder

在安装 **RDieHarder** \index{RDieHarder} 包之前需要安装依赖库，并且这个 R 包目前只能在 Linux/Mac 系统上安装 

```bash
sudo apt-get update && sudo apt-get install -y libgsl-dev libdieharder-dev
```

安装并加载 **RDieHarder** \index{RDieHarder}包

```{r RDieHarder}
library(magrittr)
library(RDieHarder)
dieharderGenerators() %>% head()
dieharderTests() %>% head()
```

RDieHarder \index{RDieHarder} [@R-RDieHarder] 由 [Dirk Eddelbuettel](http://dirk.eddelbuettel.com) 开发，将 [Robert G. Brown](http://www.phy.duke.edu/~rgb/General/dieharder.php) 的工作介绍给 R 用户

### SparkR 和 sparklyr

```{r,eval=FALSE}
library(sparklyr)
# spark_available_versions()
spark_install(version = "2.2.0", hadoop_version = "2.7")
```

### clickhouse-r

这是一个存放在Github上的包，随着 ClikHouse 在大厂的流行，此包也受到越来越多的关注
与数据仓库如何连接，如何查询数据，背后的接口 DBI 如何使用，实例化一个新的接口（如 clickhouse2r ）

- <https://github.com/hannesmuehleisen/clickhouse-r>
- 壮士！交给你个任务，基于 clickhouse 的 odbc 驱动 <https://github.com/yandex/clickhouse-odbc> 写了 R 包如何，顺带介绍 clickhouse ，再给统计之都投篇稿子，在明年的 R 会给个相关报告。名字 r4clickhouse 还是 clickhouse4r 呢

[ClickHouse](https://clickhouse.yandex/) 独辟蹊径，基于 C++ 的实现，数据查询速度超级快，官网介绍碾压大量传统数据库。还有不少接口，其中还有 R 的 <https://github.com/hannesmuehleisen/clickhouse-r> 

- 安装

```r
devtools::install_github("hannesmuehleisen/clickhouse-r")
```

- 使用

```{r,eval=FALSE}
library(DBI)
con <- dbConnect(clickhouse::clickhouse(), host="localhost", port=8123L, user="default", password="")
dbWriteTable(con, "mtcars", mtcars)
dbListTables(con)
dbGetQuery(con, "SELECT COUNT(*) FROM mtcars")
d <- dbReadTable(con, "mtcars")
dbDisconnect(con)
```

发现它和 knitr  里的 SQL 钩子，都用 DBI 这个R包  <https://github.com/rstats-db/DBI>

```{r clickhouse,fig.cap="ClickHouse与R"}
knitr::include_graphics(path = "images/clickhouse.png")
```


### reticulate

Python 与 R 交互

### INLA 

具有非常多的依赖关系，除了 CRAN 还有来自 bioconductor 的包，介绍 <http://www.r-inla.org/events/newtutorialsonspatialmodelsininla>

```{r,eval=FALSE}
install.packages("INLA",
  repos = "https://www.math.ntnu.no/inla/R/testing"
)
```

### mxnet

依赖也是很多，主要在于 GPU 版如何安装使用

### tensorflow

同样地，依赖也是很多，主要在于 GPU 版如何安装使用

# 小技巧 {#tricks}

1. 设置 Notepad++ 为 Git Bash 默认编辑器

图 \@ref(fig:notepad-git) 所示^[<http://readorskip.com/2016/09/12/Using-Notepad-to-Write-Git-Commit-Messages/>]

```{r notepad-git,fig.cap="Notepad++ 与 Git"}
knitr::include_graphics(path = "images/git-vim-commit-message.png")
```

在 Git Bash 中输入下面一行

```bash
git config --global core.editor "'c:\Program Files\Notepad++\notepad++.exe' -multiInst -notabbar -nosession -noPlugin '$*'"
```

Windows下配置 Git 中 ssh-agent 自动启动 <https://lfkid.github.io/>
这种让 Git 的 ssh-agent 常驻内存貌似不合理，占内存嘛

设置 ssh 和 store 保存应该比较好
