# 安装 R 包 {#install-package}

1. [devtools](https://github.com/r-lib/devtools) 是开发 R 包的常用工具，同时具有很重的依赖，请看

   ```{r,eval=require('devtools'),echo=TRUE}
   tools::package_dependencies('devtools',recursive=T)
   ```

   其中，依赖关系见表 \@ref(tab:devtools-sys-dep)
   
   Table: (\#tab:devtools-sys-dep) devtools 的系统依赖  

   |               |     [curl]     |      [git2r]   |    [openssl]  
   |:------------- | :------------- | :------------- | :------------- 
   |  Ubuntu       | libcurl-dev[^curl-dev] |  libgit2-dev   |   libssl-dev  
   |  CentOS       | libcurl-devel  |  libgit2-devel |  openssl-devel

[^curl-dev]: libcurl-dev 是一个虚包 virtual package，由 libcurl4-openssl-dev 或 libcurl4-nss-dev 或 libcurl4-gnutls-dev 实际提供，选择其中一个安装即可。

1. [sf](https://github.com/r-spatial/sf) 是处理空间数据的常用工具

   ```{r,eval=require('sf'),echo=TRUE}
   tools::package_dependencies('sf',recursive=T)
   ```
   
   其主要的系统依赖分别是 GEOS 3.5.1, GDAL 2.2.2, PROJ 4.9.2
   
   ```bash
   sudo add-apt-repository -y ppa:ubuntugis/ubuntugis-unstable
   sudo apt-get update
   sudo apt-get install -y libudunits2-dev libgdal-dev libgeos-dev libproj-dev 
   ```
   
   这样也同时解决了 [udunits2]、 [rgdal] 和 [rgeos] 等 3个R包的系统依赖，其中 udunits2 使用如下命令安装
   
   ```{r,eval=FALSE,echo=TRUE}
   install.packages("udunits2",configure.args='--with-udunits2-include=/usr/include/udunits2')
   ```
   
1. 图形设备支持 cairo png jpeg tiff

   ```bash
   sudo apt-get install -y libcairo2-dev libjpeg-dev libpng-dev libtiff-dev 
   ```

1. 图像处理 [imager](https://github.com/dahtah/imager) 和 [magick](https://github.com/ropensci/magick)

   ```bash
   sudo yum install fftw-devel # CentOS
   sudo apt-get install libfftw3-dev # Ubuntu
   ```
   
   在 Ubuntu 系统上安装最新的 libmagick++-dev 库
   
   ```bash
   sudo add-apt-repository -y ppa:opencpu/imagemagick
   sudo apt-get update
   sudo apt-get install -y libmagick++-dev 
   ```
   
   在 CentOS 系统上
   
   ```bash
   sudo yum install -y ImageMagick-c++-devel
   ```
   
   然后安装 R 包 `install.packages(c('imager','magick'))`

1. [rgl](https://r-forge.r-project.org/projects/rgl/) 是绘制真三维图形的重量级 R 包

   ```bash
   sudo apt-get install libcgal-dev libglu1-mesa-dev libglu1-mesa-dev libx11-dev # Ubuntu
   sudo yum install mesa-libGLU mesa-libGLU-devel # CentOS
   ```
   
   然后安装 R 包
   
   ```r
   install.packages('rgl')
   ```
   
   在 Ubuntu 系统上还可以这样安装
   
   ```bash
   sudo add-apt-repository ppa:marutter/rrutter3.5
   sudo apt-get update
   sudo apt-get install r-cran-rgl
   ```

1. [rJava](https://github.com/s-u/rJava) 是 Java 语言和 R 语言之间实现通信交流的桥梁

   ```bash
   sudo apt-get install -y default-jdk
   sudo R CMD javareconf
   ```
   
   然后安装 rJava 包 `install.packages("rJava")`


1. [igraph](https://igraph.org/) 是网络数据分析的必备 R 包，为了发挥其最大性能，需要安装三个系统依赖

   ```bash
   sudo apt-get install -y libgmp-dev libxml2-dev libglpk-dev
   ```

   然后安装 R 包

   ```r
   install.packages('igraph')
   ```
   
1. [gpuR](https://github.com/cdeterman/gpuR) 是基于 GPU 进行矩阵计算的扩展包，依赖 RcppEigen 确保安装 OpenCL 和 RViennaCL 或者 安装 Nvidia 驱动和 CUDA，使用 [gpuRcuda](https://github.com/gpuRcore/gpuRcuda) 和 [gputools](https://github.com/nullsatz/gputools) 扩展包，下面安装指导来自其 Wiki

    ```bash
    # Install OpenCL headers
    sudo apt-get install opencl-headers opencv-dev
    
    # Install NVIDIA Drivers and CUDA
    sudo add-apt-repository -y ppa:xorg-edgers/ppa
    sudo apt-get update
    sudo apt-get install nvidia-346 nvidia-settings
    ```

1. [nloptr](https://github.com/jyypma/nloptr) 是 [NLopt](https://github.com/stevengj/NLopt/) 的 R 语言接口，首先安装 NLopt 程序库 `sudo apt-get install libnlopt-dev` 然后安装 R 包`install.packages('nloptr')`，nloptr 被 700+ R 包依赖，如 lme4， spaMM， glmmTMB， rstanarm等。

1. [rstan](https://github.com/stan-dev/rstan) 是 Stan 的 R 语言接口，在 Windows 环境下安装[^install-rstan-win]

[curl]: https://github.com/jeroen/curl
[git2r]: https://github.com/ropensci/git2r
[openssl]: https://github.com/jeroen/openssl
[udunits2]: https://github.com/pacificclimate/Rudunits2
[rgdal]: https://r-forge.r-project.org/projects/rgdal/
[rgeos]: https://r-forge.r-project.org/projects/rgeos/
[rgl]: https://r-forge.r-project.org/projects/rgl/
[rJava]: https://github.com/s-u/rJava
[imager]: https://github.com/dahtah/imager
[magick]: https://github.com/ropensci/magick
[gpuR]: https://github.com/cdeterman/gpuR
[gpuRcuda]: https://github.com/gpuRcore/gpuRcuda
[gputools]: https://github.com/nullsatz/gputools
[igraph]: https://igraph.org/

[^install-rstan-win]: https://github.com/stan-dev/rstan/wiki/Using-RStan-with-the-R-3.6.0-Prerelease-on-Windows
