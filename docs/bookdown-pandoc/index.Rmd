--- 
title: "Pandoc 模板的探索"
author: "黄湘云"
date: "`r Sys.time()`"
site: bookdown::bookdown_site
documentclass: ctexbook
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
graphics: yes
tables: yes
description: "如何使用 Pandoc 模板写中文"
---

```{r setup,include=FALSE}
source("common.R")
```

# 到处都是坑

如果使用 ctex 包提供的文类，同时打开 `mathspec: yes`，会出现以下错误

> ! LaTeX Error: Option clash for package fontspec.

数学公式 $\mathbb{A,B,C,D,G,P,S,R},\mathcal{A,B,C,D,G,P,S}$

这里设置 `mathspec: yes` 目的是加载 `\usepackage{mathspec}` 而不是默认的 `\usepackage{unicode-math}`，这样一来，要想继续使用中文，就得在导言区，即 `preamble.tex` 加上 `\usepackage{ctex}`，如果直接使用 `documentclass: ctexbook` 会报错，说与 `fonspec` 包冲突

> 模板中注释掉 `\usepackage{unicode-math}`



An inline ![image](images/inkscape.png){#id .class width=30 height=20px}
and a reference ![image][ref] with attributes.

[ref]: images/inkscape.png "ink" {#id .class key=val key2="val 2"}

```{r 00-pressure,fig.cap="压力曲线"}
plot(pressure)
```

这里呢 ![image2][ref] with attributes.

如图 \@ref(fig:00-pressure)


如图 \@ref(fig:native-math)

```{python native-math, fig.cap = "本真的公式样式", dev = if(knitr::is_latex_output()) "pdf" else "png"}
from __future__ import unicode_literals
import numpy as np
import matplotlib
matplotlib.rcParams['text.usetex'] = True
matplotlib.rcParams['text.latex.unicode'] = True
import matplotlib.pyplot as plt
plt.switch_backend('agg') # Very Important in R Markdown

t = np.linspace(0.0, 1.0, 100)
s = np.cos(4 * np.pi * t) + 2

fig, ax = plt.subplots(figsize=(6, 4), tight_layout=True)
ax.plot(t, s)

ax.set_xlabel(r'\textbf{time (s)}')
# ax.set_ylabel(r'\textit{Velocity}(\N{DEGREE SIGN}/sec)', fontsize=16)
ax.set_title(r'\TeX\ is Number $\displaystyle\sum_{n=1}^\infty'
             r'\frac{-e^{i\pi}}{2^n}$!', fontsize=16, color='r')
plt.show()
```

```{python, eval = knitr::is_html_output()}
import numpy as np
from bokeh.plotting import *
from bokeh.models import ColumnDataSource

# prepare some date
N = 300
x = np.linspace(0, 4*np.pi, N)
y0 = np.sin(x)
y1 = np.cos(x)

# output to static HTML file
# output_file("linked_brushing.html")

# NEW: create a column data source for the plots to share
source = ColumnDataSource(data=dict(x=x, y0=y0, y1=y1))

TOOLS = "pan,wheel_zoom,box_zoom,reset,save,box_select,lasso_select"

# create a new plot and add a renderer
left = figure(tools=TOOLS, width=350, height=350, title=None)
left.circle('x', 'y0', source=source)

# create another new plot and add a renderer
right = figure(tools=TOOLS, width=350, height=350, title=None)
right.circle('x', 'y1', source=source)

# put the subplots in a gridplot
p = gridplot([[left, right]])

# show the results
show(p)
```

```{bash, eval = knitr::is_html_output()}
python code/selection_histogram.py
```

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```
