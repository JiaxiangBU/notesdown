--- 
title: "Pandoc 模板的探索"
author: "黄湘云"
date: "`r Sys.time()`"
site: bookdown::bookdown_site
documentclass: ctexbook
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
graphics: yes
description: "如何使用 Pandoc 模板写中文"
---

```{r setup,include=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  echo = TRUE,
  cache = TRUE,
  # citation.bibtex.max=999,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.ext = if (knitr::is_html_output()) "svg" else if (knitr::is_latex_output()) "pdf" else "png",
  dev = if (knitr::is_html_output()) "svg" else if (knitr::is_latex_output()) "cairo_pdf" else "png",
  engine.path = list(
    octave = "/usr/bin/octave-cli",
    python = "/usr/bin/python"
  )  
)
# source("common.R")
```

# 到处都是坑

如果使用 ctex 包提供的文类，同时打开 `mathspec: yes`，会出现以下错误

> ! LaTeX Error: Option clash for package fontspec.

数学公式 $\mathbb{A,B,C,D,G,P,S,R},\mathcal{A,B,C,D,G,P,S}$

这里设置 `mathspec: yes` 目的是加载 `\usepackage{mathspec}` 而不是默认的 `\usepackage{unicode-math}`，这样一来，要想继续使用中文，就得在导言区，即 `preamble.tex` 加上 `\usepackage{ctex}`，如果直接使用 `documentclass: ctexbook` 会报错，说与 `fonspec` 包冲突

> 模板中注释掉 `\usepackage{unicode-math}`

在文章插入 eps 格式的图片会报错，无法生成，这是一个坑

默认使用 [STIX 数学字体](http://www.stixfonts.org/) 和 DejaVu Sans 英文字体，如图 \@ref(fig:math-matplotlib) 所示

```{python math-matplotlib, fig.cap = "数学公式", dev = if(knitr::is_html_output()) "svg" else if(knitr::is_latex_output()) "pdf" else "png"}
import numpy as np
import matplotlib.pyplot as plt
plt.switch_backend('agg') # Very Important in R Markdown
t = np.arange(0.0, 2.0, 0.01)
s = np.sin(2*np.pi*t)

plt.plot(t,s)
plt.title(r'$\alpha_i > \beta_i$', fontsize=20)
plt.text(1, -0.6, r'$\sum_{i=0}^\infty x_i$', fontsize=20)
plt.text(0.6, 0.6, r'$\mathcal{A}\mathrm{sin}(2 \omega t)$',
         fontsize=20)
plt.xlabel('time (s)')
plt.ylabel('volts (mV)')
plt.show()
# plt.savefig('math-in-plot.png', bbox_inches='tight', dpi = 300)
# plt.savefig('math-in-plot.pdf', bbox_inches='tight')
```


```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```
