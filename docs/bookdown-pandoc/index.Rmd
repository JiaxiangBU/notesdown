--- 
title: "Pandoc 模板的探索"
author: "黄湘云"
date: "`r Sys.time()`"
site: bookdown::bookdown_site
documentclass: ctexbook
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
graphics: yes
tables: yes
description: "如何使用 Pandoc 模板写中文"
---

```{r setup,include=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  echo = TRUE,
  # citation.bibtex.max=999,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6
)
knitr::knit_hooks$set(tikz2png = function(before, options, envir) {
  # use this hook only for dev='tikz' and externalized tikz graphics
  if (before || options$dev != 'tikz' || !options$external || options$fig.num == 0) return()
  figs = knitr:::all_figs(options, ext = 'pdf')  # all figure names
  # note the tikz2png option is the extra parameters passed to 'convert'
  for (fig in figs) {
    system(sprintf('convert %s %s %s', options$tikz2png, fig, sub('\\.pdf$', '.png', fig)))
  }
})
# source("common.R")
```

# 到处都是坑

如果使用 ctex 包提供的文类，同时打开 `mathspec: yes`，会出现以下错误

> ! LaTeX Error: Option clash for package fontspec.

数学公式 $\mathbb{A,B,C,D,G,P,S,R},\mathcal{A,B,C,D,G,P,S}$

这里设置 `mathspec: yes` 目的是加载 `\usepackage{mathspec}` 而不是默认的 `\usepackage{unicode-math}`，这样一来，要想继续使用中文，就得在导言区，即 `preamble.tex` 加上 `\usepackage{ctex}`，如果直接使用 `documentclass: ctexbook` 会报错，说与 `fonspec` 包冲突

> 模板中注释掉 `\usepackage{unicode-math}`


```{r test-a, dev='tikz', fig.width=4.4, fig.height=3.3, tikz2png='-density 300'}
(x=rnorm(20))
par(mar = c(4.5, 4, .1, .1))
hist(x, main='', xlab='$x$ (how the fonts look like here?)',
  ylab='$\\hat{f}(x) = \\frac{1}{nh}\\sum_{i=1}^n \\cdots$')
```

```{r, eval=knitr::is_html_output()}
library(knitr)
library(kableExtra)
dt <- mtcars[1:5, 1:4]

# HTML table
kable(dt, format = "html", caption = "Demo Table") %>%
  kable_styling(bootstrap_options = "striped",
                full_width = F) %>%
  add_header_above(c(" ", "Group 1" = 2, "Group 2[note]" = 2)) %>%
  add_footnote(c("table footnote"))
```


```{r, eval=knitr::is_latex_output()}
library(knitr)
library(kableExtra)
dt <- mtcars[1:5, 1:4]

# LaTeX Table
kable(dt, format = "latex", booktabs = T, caption = "Demo Table") %>%
  kable_styling(latex_options = c("striped", "hold_position"),
                full_width = F) %>%
  add_header_above(c(" ", "Group 1" = 2, "Group 2[note]" = 2)) %>%
  add_footnote(c("table footnote"))
```


An inline ![image](images/inkscape.png){#id .class width=30 height=20px}
and a reference ![image][ref] with attributes.

[ref]: images/inkscape.png "ink" {#id .class key=val key2="val 2"}

```{r 00-pressure,fig.cap="压力曲线"}
plot(pressure)
```

这里呢 ![image2][ref] with attributes.

如图 \@ref(fig:00-pressure)

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```
